- no_date ||= false
- @seen_events ||= []

- if event
  - event_master_id = event.master_id || event.id
  - repeating = true if @seen_events[event_master_id]
  - @seen_events[event_master_id] = true;
  - cssclasses = ['event']
  - cssclasses << 'repeat' if repeating

  %div{:class => cssclasses.join(' ')}
    - unless no_date
      .datemark
        .mon= event.start.strftime('%b')
        .dom= event.start.strftime('%d')
    .summary
      %h2
        - if event.url
          = link_to event.name, event.url, :class => 'name'
        - else
          = event.name
        = link_to t(:download_event), event_url(event, :format => :ics), :class => 'ical download'
          
      %p.practicalities
        %span.date
          = event.start_time
        - if event.venue
          %span.location
            = t('event_page.at')
            - if event.venue.url
              = link_to event.venue.name, event.venue.url, :class => 'location'
            - else
              = event.venue.name
            - if event.venue.address
              %br
              = event.venue.address
      - unless repeating
        = simple_format event.description
    