- user ||= @user
- invitation ||= @invitation
- membership ||= false
- event ||= false
- group ||= false
- cssclass = "person"
- ineditable ||= false

- if invitation
  - cssclass << " #{invitation.status}"
  - event = invitation.event
- if membership
  - group = membership.group

%li{:id => "user_#{user.id}", :class => cssclass, :data => {:refreshable => true, :url => droom.user_path(user, :format => :js, :invitation_id => invitation ? invitation.id : nil)} }
  %span.mugshot{:style => "background-image: url(#{user.image.url('icon')})"}
    - if invitation
      - if editable?(invitation)
        = link_to invitation.status, toggle_event_invitation_url(event, invitation), :class => "invitation #{invitation.status}", :data => {:action => "affect", :method => "put", :affected => "#user_#{user.id}"}
      - else
        %span{:class => "invitation #{invitation.status}"}
  %span.contact
    %span.name
      = link_to truncate(user.formal_name, :length => 14), user_url(user), :data => {:action => "popup"}
      = action_menulink(user, :class => "small")
    %br
    %span.note
      - if user.email?
        = mail_to truncate(user.email, :length => 20)
      - else
        = t :contact_information_unavailable

    = action_menu(user, :event => event, :group => group)
